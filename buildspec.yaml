version: 0.2
phases:
  install:
     runtime-versions:
        java: corretto11
      #  maven: apache-maven-3.9.9
  pre_build:
     commands:
       - echo "Logging in to Amazon ECR.."
       - aws ecr get-login-password --region eu-north-1 | docker login --username AWS --password-stdin 494713367427.dkr.ecr.eu-north-1.amazonaws.com
  build:
     commands:
       - echo "clean the mvn repo"
       - mvn clean
       - echo "code build begin"
       - mvn compile package
       - echo "build a docker image"
       - docker build -t dhaneesh/dha:latest .
  post_build:
     commands:
       - echo "pushing the image to aws ECR"
       - docker tag  dhaneesh/dha:latest 494713367427.dkr.ecr.eu-north-1.amazonaws.com/dhaneesh/dharun:first
       - docker push 494713367427.dkr.ecr.eu-north-1.amazonaws.com/dhaneesh/dharun:first
       
      